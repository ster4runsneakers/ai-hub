<!doctype html>
<html lang="el" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ai Hub</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="static/icons/icon-192.png">
  <link rel="apple-touch-icon" href="static/icons/icon-512.png">
  <meta id="theme-color" name="theme-color" content="#0b0b10">

  <!-- iOS PWA polish -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="static/icons/icon-512.png">
  <meta name="apple-mobile-web-app-title" content="Ai Hub">

  <!-- SEO basics -->
  <meta name="description" content="Ai Hub • Projects — μικρό hub με εργαλεία (Ai Studio, Sneakers Tools, Creator Packs). Light/Dark/Auto, PWA, offline cache.">
  <link rel="canonical" href="./">

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Ai Hub • Projects">
  <meta property="og:description" content="Εργαλεία για content & e-commerce. Ελαφρύ, γρήγορο, PWA.">
  <meta property="og:image" content="static/icons/icon-512.png">
  <meta property="og:url" content="./">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Ai Hub • Projects">
  <meta name="twitter:description" content="Εργαλεία για content & e-commerce. Ελαφρύ, γρήγορο, PWA.">
  <meta name="twitter:image" content="static/icons/icon-192.png">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <header>
      <a class="brand" href="#">
        <span class="logo">AI</span>
        <span><strong>Ai Hub</strong> • Projects</span>
      </a>
      <div class="tools" role="group" aria-label="Theme">
        <button class="btn" data-theme-btn="light" aria-pressed="false">Light</button>
        <button class="btn" data-theme-btn="dark"  aria-pressed="false">Dark</button>
        <button class="btn" data-theme-btn="auto"  aria-pressed="false">Auto</button>
        <span id="theme-hint" class="hint"></span>
        <button id="btn-install" class="btn" style="margin-left:auto;display:none;">Install</button>
      </div>
    </header>

    <div class="search">
      <input id="q" placeholder="🔎 Αναζήτηση (π.χ. ai studio, captions, sneakers)">
      <select id="tag">
        <option value="">Όλα τα tags</option>
      </select>
    </div>

    <!-- Toolbar κάτω από το search -->
    <div class="toolbar">
      <div style="display:flex; gap:8px">
        <button id="btn-add" class="btn">+ Add App</button>
        <button id="btn-manage" class="btn">Manage Apps</button>
      </div>
    </div>

    <section id="grid" class="grid" aria-live="polite"></section>

    <footer>
      <div>© 2025 Ai Hub</div>
      <div>Installable PWA • Mobile friendly</div>
    </footer>
  </div>

  <!-- Add App Modal -->
  <div id="modal-backdrop" class="modal-backdrop" hidden></div>
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" hidden>
    <div class="modal-card">
      <button type="button" class="btn modal-close" aria-label="Close" style="float:right">×</button>
      <h2 id="modal-title" class="modal-title">Add App</h2>
      <form id="form-add-app" class="modal-form">
        <label>
          <span>Όνομα *</span>
          <input name="name" required placeholder="Ai Studio">
        </label>
        <label>
          <span>Περιγραφή</span>
          <input name="desc" placeholder="Short description">
        </label>
        <label>
          <span>URL (Open App)</span>
          <input name="url" placeholder="https://...">
        </label>
        <label>
          <span>Repo</span>
          <input name="repo" placeholder="https://github.com/...">
        </label>
        <label>
          <span>Icon</span>
          <input name="icon" placeholder="static/icons/icon-192.png">
        </label>
        <label>
          <span>Tags (comma-separated)</span>
          <input name="tags" placeholder="content, utils">
        </label>

        <div class="modal-actions">
          <button type="button" id="btn-cancel" class="btn">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
        <p class="hint">Αποθηκεύεται μόνο τοπικά (localStorage). Δεν κάνει commit στο GitHub.</p>
      </form>
    </div>
  </div>

  <!-- Manage Apps Modal -->
  <div id="manage-backdrop" class="modal-backdrop" hidden></div>
  <div id="manage-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="manage-title" hidden>
    <div class="modal-card">
      <button type="button" class="btn modal-close" aria-label="Close" style="float:right">×</button>
      <h2 id="manage-title" class="modal-title">Manage Apps (Local)</h2>
      <div id="manage-list" class="manage-list"></div>
      <div class="modal-actions">
        <button type="button" id="btn-clear-all" class="btn">Clear All</button>
        <button type="button" id="btn-close-manage" class="btn primary">Close</button>
      </div>
      <p class="hint">Εδώ φαίνονται μόνο όσα έχεις προσθέσει/αλλάξει τοπικά (localStorage).</p>
    </div>
  </div>

  <script>
    // ===== THEME =====
    const root=document.documentElement;
    const metaTheme=document.getElementById('theme-color');
    const hintEl=document.getElementById('theme-hint');
    const mqDark = window.matchMedia('(prefers-color-scheme: dark)');

    const systemPref = ()=> mqDark.matches ? 'dark' : 'light';
    const effectiveTheme = (mode)=> mode==='auto' ? systemPref() : mode;
    const updateMetaTheme = (mode)=> {
      const eff = effectiveTheme(mode);
      metaTheme.setAttribute('content', eff==='dark' ? '#0b0b10' : '#fbfbfe');
    };

    function applyTheme(mode){
      root.setAttribute('data-theme', mode);
      updateMetaTheme(mode);
      const eff = effectiveTheme(mode);
      hintEl.textContent = mode==='auto' ? `Auto • system: ${eff}` : `Theme: ${mode}`;
      document.querySelectorAll('.tools .btn[data-theme-btn]').forEach(b=>{
        b.setAttribute('aria-pressed', String(b.dataset.themeBtn===mode));
      });
    }
    function setTheme(mode){ localStorage.setItem('hub_theme',mode); applyTheme(mode); }

    const saved = localStorage.getItem('hub_theme') || 'auto';
    applyTheme(saved);

    document.querySelectorAll('.tools .btn[data-theme-btn]').forEach(b=>{
      b.addEventListener('click', ()=> setTheme(b.dataset.themeBtn));
    });
    const onSystemChange = ()=> {
      if ((localStorage.getItem('hub_theme')||'auto')==='auto') applyTheme('auto');
    };
    if (mqDark.addEventListener) mqDark.addEventListener('change', onSystemChange);
    else if (mqDark.addListener) mqDark.addListener(onSystemChange);

    // ===== APPS (με Add App, Manage Apps & localStorage) =====
    const state={apps:[], q:'', tag:''};
    const grid=document.getElementById('grid');
    const selTag=document.getElementById('tag');
    const inputQ=document.getElementById('q');

    const LS_KEY = 'hub_user_apps_v1';

    function loadLocalApps(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      }catch(e){ return []; }
    }
    function saveLocalApps(arr){
      localStorage.setItem(LS_KEY, JSON.stringify(arr||[]));
    }
    function mergeApps(base, extra){
      const map = new Map();
      base.forEach(a=> map.set((a.name||'').toLowerCase(), a));
      extra.forEach(a=> map.set((a.name||'').toLowerCase(), a));
      return [...map.values()];
    }

    fetch('apps.json?_='+Date.now())
      .then(r=>r.json())
      .then(d=>{
        const base = (d && Array.isArray(d.apps)) ? d.apps : [];
        const extra = loadLocalApps();
        state.apps = mergeApps(base, extra);

        const tags=new Set();
        state.apps.forEach(a=> (a.tags||[]).forEach(t=> tags.add(t)));
        [...tags].sort().forEach(t=>{
          const opt=document.createElement('option'); opt.value=t; opt.textContent=t; selTag.appendChild(opt);
        });
        render();
      })
      .catch(()=>{
        state.apps = mergeApps([], loadLocalApps());
        render();
      });

    const esc = (s)=> (s||'').replace(/[&<>"]/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]));
    function card(a){
      const icon = a.icon ? `<img src="${esc(a.icon)}" alt="" width="24" height="24" style="border-radius:6px;border:1px solid var(--ring)">` : '🚀';
      const tags = (a.tags||[]).map(t=>`<span class="badge">${esc(t)}</span>`).join('');

      const openBtn = a.url  ? `<a class="btn primary" href="${esc(a.url)}" target="_blank" rel="noopener">Open App</a>` : '';
      const repoBtn = a.repo ? `<a class="btn" href="${esc(a.repo)}" target="_blank" rel="noopener">Repo</a>` : '';
      const actions = (openBtn || repoBtn)
        ? `<div class="actions">${openBtn}${repoBtn}</div>`
        : `<div class="actions"><span class="hint">🚧 Coming soon</span></div>`;

      return `
        <article class="card">
          <div style="display:flex;gap:10px;align-items:center">
            <div>${icon}</div><div class="title">${esc(a.name)}</div>
          </div>
          <div class="desc">${esc(a.desc||'')}</div>
          <div class="badges">${tags}</div>
          ${actions}
        </article>`;
    }
    function render(){
      const q=(state.q||'').toLowerCase(), tag=state.tag||'';
      const list=state.apps.filter(a=>{
        const hay = [a.name,a.desc,(a.repo||''),(a.url||''),(a.tags||[]).join(' ')].join(' ').toLowerCase();
        const matchesQ = !q || hay.includes(q);
        const matchesTag = !tag || (a.tags||[]).includes(tag);
        return matchesQ && matchesTag;
      });
      grid.innerHTML = list.map(a=>card(a)).join('') || '<div class="desc">Δεν βρέθηκαν apps.</div>';
    }
    inputQ.addEventListener('input',e=>{ state.q=e.target.value; render(); });
    selTag.addEventListener('change',e=>{ state.tag=e.target.value; render(); });

    // ===== Add App modal logic (robust) =====
    const btnAdd = document.getElementById('btn-add');
    const modal = document.getElementById('modal');
    const backdrop = document.getElementById('modal-backdrop');
    const form = document.getElementById('form-add-app');
    const btnCancel = document.getElementById('btn-cancel');

    function closeModal(){
      if(!modal) return;
      modal.hidden = true;
      if(backdrop) backdrop.hidden = true;
      if(form) form.reset();
    }
    function openModal(){
      if(!modal) return;
      modal.hidden = false;
      if(backdrop) backdrop.hidden = false;
      const first = form && form.querySelector('input[name="name"]');
      setTimeout(()=> first && first.focus(), 0);
    }

    if (btnAdd) btnAdd.addEventListener('click', openModal);
    if (btnCancel) btnCancel.addEventListener('click', closeModal);
    if (backdrop) backdrop.addEventListener('click', closeModal);

    document.addEventListener('keydown', (e)=> {
      if (!modal || modal.hidden) return;
      if (e.key === 'Escape') closeModal();
    });
    document.addEventListener('click', (e)=>{
      if (!modal || modal.hidden) return;
      if (e.target && e.target.closest && e.target.closest('.modal-close')) {
        e.preventDefault();
        return closeModal();
      }
      if (e.target === modal) {
        e.preventDefault();
        return closeModal();
      }
    });

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(form);
      const name = (fd.get('name')||'').toString().trim();
      if(!name){ return; }

      const app = {
        name,
        desc: (fd.get('desc')||'').toString().trim(),
        url:  (fd.get('url')||'').toString().trim(),
        repo: (fd.get('repo')||'').toString().trim(),
        icon: (fd.get('icon')||'').toString().trim(),
        tags: ((fd.get('tags')||'').toString().split(',').map(s=>s.trim()).filter(Boolean)) || []
      };

      const extra = loadLocalApps();
      const idx = extra.findIndex(x => (x.name||'').toLowerCase() === name.toLowerCase());
      if(idx >= 0) extra[idx] = app; else extra.push(app);
      saveLocalApps(extra);

      state.apps = mergeApps(state.apps, [app]);

      app.tags.forEach(t=>{
        if(![...selTag.options].some(o=>o.value===t)){
          const opt=document.createElement('option'); opt.value=t; opt.textContent=t; selTag.appendChild(opt);
        }
      });

      closeModal();
      render();
    });

    // ===== Manage Apps (list/delete/clear) =====
    const btnManage = document.getElementById('btn-manage');
    const manageModal = document.getElementById('manage-modal');
    const manageBackdrop = document.getElementById('manage-backdrop');
    const manageList = document.getElementById('manage-list');
    const btnCloseManage = document.getElementById('btn-close-manage');
    const btnClearAll = document.getElementById('btn-clear-all');

    function openManage(){
      renderManageList();
      manageModal.hidden = false;
      manageBackdrop.hidden = false;
    }
    function closeManage(){
      manageModal.hidden = true;
      manageBackdrop.hidden = true;
    }
    function renderManageList(){
      const extra = loadLocalApps();
      if(!extra.length){
        manageList.innerHTML = '<div class="desc">Δεν υπάρχουν τοπικά apps.</div>';
        return;
      }
      manageList.innerHTML = extra.map(a=>`
        <div class="manage-row">
          <div class="manage-info">
            <div class="manage-name">${esc(a.name)}</div>
            <div class="manage-meta">${esc(a.desc||'')}</div>
          </div>
          <div class="manage-actions">
            <button class="btn" data-del="${esc(a.name)}">Delete</button>
          </div>
        </div>
      `).join('');
    }

    if (btnManage) btnManage.addEventListener('click', openManage);
    if (btnCloseManage) btnCloseManage.addEventListener('click', closeManage);
    if (manageBackdrop) manageBackdrop.addEventListener('click', closeManage);
    document.addEventListener('click', (e)=>{
      if (!manageModal || manageModal.hidden) return;
      if (e.target && e.target.closest && e.target.closest('.modal-close')) {
        e.preventDefault();
        return closeManage();
      }
      if (e.target === manageModal) {
        e.preventDefault();
        return closeManage();
      }
      // delete buttons
      const btn = e.target.closest && e.target.closest('[data-del]');
      if(btn){
        const name = btn.getAttribute('data-del');
        const extra = loadLocalApps().filter(x=> (x.name||'').toLowerCase() !== (name||'').toLowerCase());
        saveLocalApps(extra);
        // refresh state.apps (re-merge with base)
        fetch('apps.json?_='+Date.now())
          .then(r=>r.json()).then(d=>{
            const base = (d && Array.isArray(d.apps)) ? d.apps : [];
            state.apps = mergeApps(base, extra);
            render();
            renderManageList();
          }).catch(()=>{
            state.apps = mergeApps([], extra);
            render();
            renderManageList();
          });
      }
    });
    if (btnClearAll) btnClearAll.addEventListener('click', ()=>{
      if(confirm('Σίγουρα θέλεις να διαγράψεις ΟΛΑ τα τοπικά apps;')){
        saveLocalApps([]);
        fetch('apps.json?_='+Date.now())
          .then(r=>r.json()).then(d=>{
            const base = (d && Array.isArray(d.apps)) ? d.apps : [];
            state.apps = mergeApps(base, []);
            render();
            renderManageList();
          }).catch(()=>{
            state.apps = mergeApps([], []);
            render();
            renderManageList();
          });
      }
    });

    // ===== PWA INSTALL BUTTON =====
    let deferredPrompt=null;
    const installBtn=document.getElementById('btn-install');

    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      deferredPrompt=e;
      installBtn.style.display='inline-block';
    });

    installBtn.addEventListener('click', async ()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt=null;
      installBtn.style.display='none';
    });

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('service-worker.js').catch(console.warn);
    }
  </script>
</body>
</html>
